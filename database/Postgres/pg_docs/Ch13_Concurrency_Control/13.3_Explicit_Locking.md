# Row-level locks

Row-level locks do not affect data querying (reads); they block only **writers**
and **lockers** to the same row. 

* `FOR UPDATE`

  > I will write this row

  Semantics: Strongest row-level **exclusive** lock

  Can be acquired via:
  
  1. `SELECT ... FOR UPDATE`
  2. `DELETE`
  3. `UPDATE` on columns that have a unique index (aka, key columns)
  
  It conflicts these locks:
  
  1. `FOR UPDATE`
  2. `FOR NO KEY UPDATE`
  3. `FOR SHARE`
  4. `FOR KEY SHARE`
  
  And stops other txn from:
  
  1. `UPDATE`
  2. `DELETE`
  3. `SELECT FOR UPDATE`
  4. `SELECT FOR NO KEY UPDATE`
  5. `SELECT FOR SHARE`
  6. `SELECT FOR KEY SHARE`
  
  > QUES: I think this should be renamed to `SELECT FOR KEY UPDATE` considering
  > only `UPDATES` on key columns acquire this lock???
  
* `FOR NO KEY UPDATE`

  > I will write this row, but I guarantee you that I won't modify key columns.

  Semantics: Similar to `FOR UPDATE`, but weaker. A txn that holds this lock cannot
  modify the key columns. With this guarantee, such txns can be concurrently
  executed with transactions that rely on key columns, and thus more concurrency
  will be allowed.
  
  Can be acquired via:
  
  1. `SELECT FOR NO KEY UPDATE`
  2. `UPDATE` on non-key columns
  
  It conflicts with these locks:
  
  1. `FOR UPDATE`
  2. `FOR NO KEY UPDATE`
  3. `FOR SHARE`
  
  Stops other txns from:
  
  1. `UPDATE`
  2. `DELETE`
  3. `SELECT FOR UPDATE`
  4. `SELECT FOR NO KEY UPDATE`
  5. `SELECT FOR SHARE`
  
* `FOR SHARE`

  > I will read this row, I don't want it to be updated or deleted.

  Shared lock 
  
  It conflicts with these locks
  
  * `FOR UPDATE`
  * `FOR NO KEY UPDATE`
  
  Stops other txns from:
  
  1. `UPDATE`
  2. `DELETE`
  3. `SELECT FOR UPDATE`
  4. `SELECT FOR NO KEY UPDATE`
  
  Can be acquired via `SELECT FOR SHARE`

* `FOR KEY SHARE`
  
  > I will read the key columns of this row. So it cannot:
  >
  > 1. be deleted
  > 2. its key columns cannot be updated
  
  Weaker shared lock
  
  It conflicts with `FOR UPDATE`. Stops from other txns from:
  
  1. `UPDATE` on key columns
  2. `DELETE`
  2. `SELECT FOR UPDATE`
  
  Can be acquired via:
  
  1. `SELECT FOR KEY SHARE`
  2. When a row gets referenced from a foreign key
  

`FOR NO KEY UPDATE` and `FOR KEY SHARE` exist to improve concurrency.
  